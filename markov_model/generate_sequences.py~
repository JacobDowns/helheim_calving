import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import interp1d
from markov_model import MarkovModel
from scipy.ndimage import label
from scipy.io import savemat

mm = MarkovModel()
runoff = mm.runoff
ts = mm.ts

indexes = ts >= 2007.
ts = ts[indexes]
runoff = runoff[indexes]
states = []

ts = np.concatenate([ts, ts[1:]+12., ts[1:]+24., ts[1:]+36])
runoff = np.concatenate([runoff, runoff[1:], runoff[1:], runoff[1:]])

for i in range(100):
    states_i = mm.get_sequence(runoff)

    indexes_A = states_i == 'A'
    numeric_states = np.zeros(len(states_i))
    numeric_states[indexes_A] = 1.

    states.append(numeric_states)
    print(numeric_states)

states = np.array(states)

plt.subplot(2,1,1)
plt.plot(ts, states.sum(axis=0))

plt.subplot(2,1,2)
plt.plot(ts, runoff)

np.save('data/sequence_ts', ts)
np.save('data/markov_sequences', states)

savemat('data/markov_sequences.mat', {'markov_sequences' : states, 'ts' : ts})
plt.show()
    




